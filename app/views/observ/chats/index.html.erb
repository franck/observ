<% content_for :title, "Agent Testing - Chats" %>

<% content_for :page_header do %>
  <div class="observ-page-header__content">
    <h1 class="observ-page-header__title">Agent Testing</h1>
    <div class="observ-page-header__actions">
      <%= link_to "New Chat", new_chat_path, class: "observ-button observ-button--primary" %>
    </div>
  </div>
<% end %>

<% if notice.present? %>
  <div class="observ-alert observ-alert--success">
    <%= notice %>
  </div>
<% end %>

<div class="observ-card">
  <div class="observ-card__body">
    <% if @chats.any? %>
      <table class="observ-table">
        <thead class="observ-table__header">
          <tr class="observ-table__row">
            <th class="observ-table__cell">Model</th>
            <th class="observ-table__cell">Agent</th>
            <th class="observ-table__cell observ-table__cell--numeric">Messages</th>
            <th class="observ-table__cell">Created</th>
            <th class="observ-table__cell">Observability</th>
            <th class="observ-table__cell"></th>
          </tr>
        </thead>
        <tbody>
          <% @chats.each do |chat| %>
            <tr class="observ-table__row">
              <td class="observ-table__cell">
                <%= chat.model&.name || 'Default' %>
              </td>
              <td class="observ-table__cell">
                <%= chat.agent_class_name.presence || 'BaseAgent' %>
              </td>
              <td class="observ-table__cell observ-table__cell--numeric">
                <%= chat.messages.count %>
              </td>
              <td class="observ-table__cell">
                <%= observ_relative_time(chat.created_at) %>
              </td>
              <td class="observ-table__cell">
                <% if chat.observ_session %>
                  <%= link_to "View Session", session_path(chat.observ_session), class: "observ-link" %>
                <% else %>
                  â€”
                <% end %>
              </td>
              <td class="observ-table__cell observ-table__cell--actions">
                <%= link_to "Open", chat_path(chat), class: "observ-button observ-button--sm" %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    <% else %>
      <p class="observ-card__empty">No chats found. Create your first chat to test agents.</p>
    <% end %>
  </div>
</div>

<%= observ_pagination(@chats) %>

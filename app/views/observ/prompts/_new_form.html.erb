<%= form_with model: form, url: prompts_path, method: :post do |f| %>

  <% if form.errors.any? %>
    <div class="observ-alert observ-alert--danger">
      <h3 class="observ-alert__title">
        <%= pluralize(form.errors.count, "error") %> prohibited this prompt from being saved:
      </h3>
      <ul class="observ-alert__list">
        <% form.errors.full_messages.each do |message| %>
          <li><%= message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div class="observ-card">
    <div class="observ-card__body">
      <!-- Prompt Name -->
      <div class="observ-form__group">
        <%= f.label :name, "Prompt Name", class: "observ-form__label" %>
        <%= f.text_field :name,
          placeholder: "e.g., research-agent-system-prompt",
          class: "observ-form__input" %>
        <p class="observ-form__hint">
          Use kebab-case. This will be used to identify the prompt (e.g., "my-agent-system-prompt")
        </p>
      </div>

      <!-- Commit Message -->
      <div class="observ-form__group">
        <%= f.label :commit_message, "Commit Message", class: "observ-form__label" %>
        <%= f.text_area :commit_message,
          rows: 2,
          placeholder: "Describe what changed in this version...",
          class: "observ-form__textarea" %>
        <p class="observ-form__hint">
          Optional but recommended for tracking changes
        </p>
      </div>

      <!-- Prompt Content -->
      <div class="observ-form__group" data-controller="observ--prompt-variables">
        <%= f.label :prompt, "Prompt Content", class: "observ-form__label" %>
        <%= f.text_area :prompt,
          rows: 15,
          placeholder: "Enter your prompt here...\n\nUse {{variable_name}} for dynamic variables.",
          class: "observ-form__textarea observ-form__textarea--code",
          data: { 
            observ__prompt_variables_target: "input",
            action: "input->observ--prompt-variables#detectVariables"
          } %>
        <p class="observ-form__hint">
          Use <code class="observ-code">{{variable_name}}</code> syntax for variables
        </p>

        <!-- Variable Preview -->
        <div data-observ--prompt-variables-target="preview" class="observ-prompt-form__variable-preview">
          <p class="observ-prompt-form__variable-title">Detected Variables:</p>
          <div data-observ--prompt-variables-target="list" class="observ-prompt-form__variable-list"></div>
        </div>
      </div>

      <!-- Configuration (JSON) -->
      <div class="observ-form__group">
        <%= f.label :config, "Configuration (JSON)", class: "observ-form__label" %>
        <%= f.text_area :config,
          rows: 8,
          placeholder: '{\n  "model": "gpt-4o",\n  "temperature": 0.7,\n  "max_tokens": 2000\n}',
          class: "observ-form__textarea observ-form__textarea--code",
          data: { controller: "json-editor" } %>
        <p class="observ-form__hint">
          Optional JSON configuration for model parameters and metadata
        </p>
      </div>

      <!-- Hidden field for from_version -->
      <%= f.hidden_field :from_version %>

      <!-- Actions -->
      <div class="observ-form__actions observ-form__actions--between">
        <div class="observ-form__checkbox-group">
          <label class="observ-form__checkbox-label">
            <%= f.check_box :promote_to_production, class: "observ-form__checkbox" %>
            <span class="observ-form__checkbox-custom"></span>
            <span class="observ-form__checkbox-text">
              Promote to production immediately
            </span>
          </label>
          <p class="observ-form__checkbox-hint">
            If unchecked, prompt will be saved as draft
          </p>
        </div>

        <div class="observ-form__actions-group">
          <%= link_to "Cancel", prompts_path, class: "observ-button" %>
          <%= f.submit "Create Prompt", class: "observ-button observ-button--primary" %>
        </div>
      </div>
    </div>
  </div>
<% end %>

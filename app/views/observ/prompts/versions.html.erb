<% content_for :title, "Version History" %>

<% content_for :page_header do %>
  <div class="observ-page-header__content">
    <div>
      <%= link_to "â† Back to Prompt", prompt_path(@prompt_name), class: "observ-link" %>
      <h1 class="observ-page-header__title">Version History</h1>
      <p class="observ-prompt-header__subtitle"><%= @prompt_name %></p>
    </div>
  </div>
<% end %>

<div class="observ-container">
  <!-- Timeline View -->
  <div class="observ-card">
    <div class="observ-card__body">
      <div class="observ-timeline">
        <% @versions.each_with_index do |version, index| %>
          <div class="observ-timeline__item">
            <!-- Timeline Line -->
            <div class="observ-timeline__marker">
              <div class="observ-timeline__dot observ-timeline__dot--<%= case version.state
                  when 'production' then 'success'
                  when 'draft' then 'warning'
                  when 'archived' then 'muted'
                  end %>">
              </div>
              <% unless index == @versions.count - 1 %>
                <div class="observ-timeline__line"></div>
              <% end %>
            </div>

            <!-- Version Card -->
            <div class="observ-timeline__content">
              <div class="observ-version-card">
                <div class="observ-version-card__header">
                  <div>
                    <div class="observ-version-card__title-row">
                      <h3 class="observ-version-card__title">Version <%= version.version %></h3>
                      <span class="observ-badge <%= case version.state
                          when 'draft' then 'observ-badge--warning'
                          when 'production' then 'observ-badge--success'
                          when 'archived' then 'observ-badge--default'
                          end %>">
                        <%= version.state.titleize %>
                      </span>
                    </div>

                    <p class="observ-version-card__meta">
                      <%= version.created_at.strftime("%B %d, %Y at %I:%M %p") %>
                      <% if version.created_by.present? %>
                        by <span class="observ-version-card__author"><%= version.created_by %></span>
                      <% end %>
                    </p>

                    <% if version.commit_message.present? %>
                      <p class="observ-version-card__commit">
                        "<%= version.commit_message %>"
                      </p>
                    <% end %>
                  </div>

                  <div class="observ-version-card__actions">
                    <%= link_to "View", prompt_path(@prompt_name, version: version.version), class: "observ-button observ-button--sm observ-button--secondary" %>

                    <% if @production_version && version != @production_version %>
                      <%= link_to "Compare with Production",
                        compare_prompt_path(@prompt_name,
                          from: @production_version.version,
                          to: version.version),
                        class: "observ-button observ-button--sm" %>
                    <% end %>
                  </div>
                </div>

                <!-- Preview -->
                <div class="observ-version-card__preview">
                  <%= truncate(version.prompt, length: 200) %>
                </div>
              </div>
            </div>
          </div>
        <% end %>
      </div>
    </div>
  </div>
</div>

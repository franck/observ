<%= form_with model: dataset,
              scope: :observ_dataset,
              url: dataset.persisted? ? dataset_path(dataset) : datasets_path,
              method: dataset.persisted? ? :patch : :post,
              class: "observ-form" do |f| %>

  <% if dataset.errors.any? %>
    <div class="observ-alert observ-alert--danger">
      <h3 class="observ-alert__title">Please fix the following errors:</h3>
      <ul class="observ-alert__list">
        <% dataset.errors.full_messages.each do |message| %>
          <li><%= message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div class="observ-form__group">
    <%= f.label :name, class: "observ-form__label" %>
    <%= f.text_field :name,
          class: "observ-form__input",
          placeholder: "e.g., language-detection-tests",
          required: true %>
    <p class="observ-form__hint">A unique name for this dataset</p>
  </div>

  <div class="observ-form__group">
    <%= f.label :description, class: "observ-form__label" %>
    <%= f.text_area :description,
          class: "observ-form__textarea",
          rows: 3,
          placeholder: "Describe what this dataset tests..." %>
    <p class="observ-form__hint">Optional description of this dataset's purpose</p>
  </div>

  <div class="observ-form__group">
    <%= f.label :agent_class, "Agent", class: "observ-form__label" %>
    <% if agents.any? %>
      <%= f.select :agent_class,
            options_for_select(agents, dataset.agent_class),
            { prompt: "Select an agent..." },
            { class: "observ-form__select", required: true } %>
    <% else %>
      <%= f.text_field :agent_class,
            class: "observ-form__input",
            placeholder: "e.g., MyAgent",
            required: true %>
      <p class="observ-form__hint observ-form__hint--warning">
        No agents found. Enter the agent class name manually.
      </p>
    <% end %>
    <p class="observ-form__hint">The agent that will be run against this dataset</p>
  </div>

  <div class="observ-form__actions">
    <%= f.submit dataset.persisted? ? "Update Dataset" : "Create Dataset",
          class: "observ-button observ-button--primary" %>
    <%= link_to "Cancel",
          dataset.persisted? ? dataset_path(dataset) : datasets_path,
          class: "observ-button" %>
  </div>
<% end %>

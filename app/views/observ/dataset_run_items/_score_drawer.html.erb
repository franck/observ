<div class="observ-drawer__header">
  <h2 class="observ-drawer__title">Score Item</h2>
</div>

<div class="observ-drawer__body">
  <% if local_assigns[:error] %>
    <div class="observ-alert observ-alert--danger"><%= error %></div>
  <% end %>

  <div class="observ-datasets__score-context">
    <h4 class="observ-text--label">Input</h4>
    <pre class="observ-code-block"><%= format_trace_data(run_item.input) %></pre>

    <% if run_item.expected_output.present? %>
      <h4 class="observ-text--label">Expected Output</h4>
      <pre class="observ-code-block"><%= format_trace_data(run_item.expected_output) %></pre>
    <% end %>

    <h4 class="observ-text--label">Actual Output</h4>
    <pre class="observ-code-block"><%= format_trace_data(run_item.actual_output) %></pre>
  </div>

  <% existing_manual = run_item.score_for("manual", source: :manual) %>

  <%= form_with url: score_dataset_run_run_item_path(run_item.dataset_run.dataset, run_item.dataset_run, run_item), method: :post, class: "observ-form" do |f| %>
    <div class="observ-form__group">
      <label class="observ-form__label">Is the output correct?</label>
      <div class="observ-datasets__score-buttons">
        <label class="observ-datasets__score-button">
          <input type="radio" name="value" value="1" <%= "checked" if existing_manual&.passed? %>>
          <span class="observ-datasets__score-icon observ-datasets__score-icon--pass">&#10003;</span>
          Correct
        </label>
        <label class="observ-datasets__score-button">
          <input type="radio" name="value" value="0" <%= "checked" if existing_manual&.failed? %>>
          <span class="observ-datasets__score-icon observ-datasets__score-icon--fail">&#10005;</span>
          Incorrect
        </label>
      </div>
    </div>

    <div class="observ-form__group">
      <label class="observ-form__label" for="comment">Comment (optional)</label>
      <textarea name="comment" id="comment" class="observ-form__textarea" rows="3"><%= existing_manual&.comment %></textarea>
    </div>

    <div class="observ-form__actions">
      <button type="submit" class="observ-button observ-button--primary">Save Score</button>
      <button type="button" class="observ-button" data-action="click->observ--drawer#close">Cancel</button>
    </div>
  <% end %>

  <% if run_item.scores.any? %>
    <div class="observ-datasets__existing-scores">
      <h4 class="observ-text--label">Existing Scores</h4>
      <ul class="observ-scores-list">
        <% run_item.scores.each do |score| %>
          <li class="observ-scores-list__item">
            <span class="observ-scores-list__indicator <%= score.passed? ? 'observ-scores-list__indicator--pass' : 'observ-scores-list__indicator--fail' %>">
              <%= score.passed? ? '✓' : '✗' %>
            </span>
            <span class="observ-scores-list__name"><%= score.name %></span>
            <% unless score.boolean? %>
              <span class="observ-scores-list__value"><%= score.display_value %></span>
            <% end %>
            <span class="observ-scores-list__source"><%= score.source %></span>
            <% if score.comment.present? %>
              <span class="observ-scores-list__comment"><%= score.comment %></span>
            <% end %>
          </li>
        <% end %>
      </ul>
    </div>
  <% end %>
</div>
